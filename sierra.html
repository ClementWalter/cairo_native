<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sierra - Denwen Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="setup.html"><strong aria-hidden="true">2.</strong> Project Setup</a></li><li class="chapter-item expanded "><a href="layout.html"><strong aria-hidden="true">3.</strong> Code Layout</a></li><li class="chapter-item expanded "><a href="sierra.html" class="active"><strong aria-hidden="true">4.</strong> Sierra</a></li><li class="chapter-item expanded "><a href="gas.html"><strong aria-hidden="true">5.</strong> Gas</a></li><li class="chapter-item expanded "><a href="mlir.html"><strong aria-hidden="true">6.</strong> MLIR</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Denwen Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/mdBook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/lambdaclass/cairo_sierra_2_MLIR/edit/main/docs/src/sierra.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sierra-cairo-intermediate-representation"><a class="header" href="#sierra-cairo-intermediate-representation">Sierra: Cairo Intermediate Representation</a></h1>
<h2 id="online-resources"><a class="header" href="#online-resources">Online Resources</a></h2>
<ul>
<li><a href="https://medium.com/starkware/cairo-1-0-aa96eefb19a0">Cairo 1.0</a></li>
<li><a href="https://medium.com/yagi-fi/reading-sierra-starknets-secret-sauce-for-cairo-1-0-5bc73409e43c">Reading Sierra: Starknet's secret sauce for Cairo 1.0</a></li>
<li><a href="https://www.youtube.com/watch?v=-EHwaQuPuAA">StarkWare Sessions 23 | Sierra - Enforcing Safety Using Typesystems | Shahar Papini</a></li>
<li><a href="https://docs.rs/cairo-lang-sierra/latest/cairo_lang_sierra/">docs.rs: cairo_lang_sierra</a></li>
<li><a href="https://docs.rs/cairo-lang-sierra-ap-change/latest/cairo_lang_sierra_ap_change/">docs.rs: cairo_lang_sierra_ap_change</a></li>
<li><a href="https://docs.rs/cairo-lang-sierra-gas/latest/cairo_lang_sierra_gas/">docs.rs: cairo_lang_sierra_gas</a></li>
<li><a href="https://docs.rs/cairo-lang-sierra-generator/latest/cairo_lang_sierra_generator/">docs.rs: cairo_lang_sierra_generator</a></li>
<li><a href="https://docs.rs/crate/cairo-lang-sierra-to-casm/latest">docs.rs: cairo_lang_sierra_to_casm</a></li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<h3 id="cairo-10"><a class="header" href="#cairo-10"><a href="https://medium.com/starkware/cairo-1-0-aa96eefb19a0">Cairo 1.0</a></a></h3>
<p>Cairo 1.0 will give developers a safer, simpler, more usable programming language.</p>
<p>At the heart of Cairo 1.0 will be Sierra, an intermediary representation layer that promises greater long term stability for Cairo programs.</p>
<p>Sierra advances Cairo to serve in a permissionless network:</p>
<ul>
<li>Protecting the network: it allows more robust DoS protection</li>
<li>Protecting the user: it allows Ethereum-grade censorship resistance</li>
</ul>
<p>While Cairo made STARKs accessible, it was originally designed as an assembly language, and as such it was written as a low level language.
Cairo was gradually made more expressive and more developer-friendly.</p>
<p>Introducing Sierra: ensuring every Cairo run can be proven</p>
<p>The main addition in Cairo 1.0 is Sierra (Safe Intermediate Representation). 
Sierra constitutes a new intermediate representation layer between Cairo 1.0 and Cairo byte code. 
Sierra’s goal is to ensure that every Cairo run — i.e. a Cairo program and its input — can be proven.</p>
<p>Sierra promises Cairo devs better future-proof code. 
Further stability is provided by the fact that StarkNet contracts won’t need recompiling in the case of improvements to the underlying system (e.g., CPU AIR architecture changes, improvements of the final translation from Sierra to Cairo byte code).</p>
<p>Proving every Cairo run. </p>
<p>In old Cairo, a Cairo run can result in three cases — TRUE, FALSE, or failure. 
Failed runs can’t be proven. Sierra, ensures that a Cairo run will never fail, and can only result in TRUE or FALSE. 
This in turn, ensures that every Cairo run can be proven.</p>
<p>This introduction of Sierra has important implications for StarkNet as a permissionless network. 
Sierra ensures that even reverted transactions can be included in StarkNet blocks. 
This property will allow the StarkNet protocol to remain lean and simple without the need to add complex crypto-economic mechanisms.</p>
<h3 id="reading-sierra-starknets-secret-sauce-for-cairo-10"><a class="header" href="#reading-sierra-starknets-secret-sauce-for-cairo-10"><a href="https://medium.com/yagi-fi/reading-sierra-starknets-secret-sauce-for-cairo-1-0-5bc73409e43c">Reading Sierra: Starknet's secret sauce for Cairo 1.0</a></a></h3>
<p>Starknet also has an intermediate language called Sierra, built as a stable layer to allow for rapid iteration and innovation at the Cairo 1.0 language level. While not absolutely essential to write efficient programs (Starknet contracts written in high-level Cairo will be orders of magnitude more efficient than hand-optimized Solidity contracts), reading Sierra code can help us get a deeper understanding of the underlying type system, security risks and improving efficiency where it matters (e.g., reducing the storage footprint or execution steps in highly recursive functions).</p>
<p>The Sierra output is organized into 4 separate sections always presented in the same order. First come the type declarations. Next, declarations of built-in library functions that will be used. Then the sequence of statements and finally the declared Cairo functions.</p>
<p>A couple of observations:</p>
<ul>
<li>The Unit type () is a special case of an empty struct and is used as a default return type for procedures (functions without a declared return type)</li>
<li>New temporary variables are created and indexed using square brackets ( <code>[0]</code> and <code>[1]</code> )</li>
<li>Statements have the following form <code>&lt;libfunc&gt;(&lt;inputs&gt;) -&gt; (&lt;outputs&gt;);</code>, i.e., we don't see the more traditional <code>[0] = struct_construct&lt;Unit&gt;();</code></li>
<li>Code blocks are separate from Cairo function declarations. A function is tied to a specific block of code by starting at a dedicated statement index location (note the do_nothing@0 which indicates that the function begins at the first statement).</li>
</ul>
<h3 id="twitter-thread"><a class="header" href="#twitter-thread"><a href="https://twitter.com/p_e/status/1633105488731619328">Twitter thread</a></a></h3>
<p>For more complex functions Sierra does much more:</p>
<ul>
<li>includes corelib code</li>
<li>translates control flow in function calls and jumps</li>
<li>expresses compound types in terms of built-in types</li>
<li>automatically includes ZK built-ins (remember 0.x?)</li>
</ul>
<h3 id="twitter-thread-1"><a class="header" href="#twitter-thread-1"><a href="https://twitter.com/lucas_lvy/status/1578341084735758336">Twitter thread</a></a></h3>
<p>We introduce SIERRA a Safe IntErmediate RepResentAtion of @CairoLang that is always provable which means that it never fails so asserts will be transformed into if statements. Don't be scared of this it adds almost no overhead to your bytecode !
As SIERRA is always provable it's also a way to prevent DOS attacks. The network will be able to include failed transactions and collect fees on them.</p>
<h3 id="crate-documentation"><a class="header" href="#crate-documentation">Crate Documentation</a></h3>
<p>Sierra is an intermediate representation between high level Cairo and compilation targets, such as CASM. 
Sierra code is guaranteed to be “safe”* by construction. 
Sierra has a primitive, yet rich typing system to express all high level code while guaranteeing safety and allowing for efficient compilation down to the target.</p>
<p>Safety - this means a few things:</p>
<ul>
<li>There are no “panics” / “runtime errors”. Every function is guaranteed to return.</li>
<li>There are no infinite loops. Moreover, every program “counts” its own steps, and returns when the limit is reached.</li>
<li>Builtin library functions are always used correctly.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="layout.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="gas.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="layout.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="gas.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </div>
    </body>
</html>
